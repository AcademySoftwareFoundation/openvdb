SET(OPENVDB_SOURCE_FILES

	Grid.cc
	Platform.cc
    openvdb.cc)


SET(OPENVDB_HEADER_FILES

	Exceptions.h
	Grid.h
	Metadata.h
	Platform.h
    PlatformConfig.h
	Types.h
	openvdb.h
	version.h)



# IO

FILE(GLOB OPENVDB_IO_SOURCE_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/io/*.cc)

FILE(GLOB OPENVDB_IO_HEADER_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/io/*.h)

SOURCE_GROUP(IO FILES ${OPENVDB_IO_SOURCE_FILES} ${OPENVDB_IO_HEADER_FILES})



# Math

FILE(GLOB OPENVDB_MATH_SOURCE_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/math/*.cc)

FILE(GLOB OPENVDB_MATH_HEADER_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/math/*.h)

SOURCE_GROUP(Math FILES ${OPENVDB_MATH_SOURCE_FILES} ${OPENVDB_MATH_HEADER_FILES})



# Metadata

FILE(GLOB OPENVDB_METADATA_SOURCE_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/metadata/*.cc)

FILE(GLOB OPENVDB_METADATA_HEADER_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/metadata/*.h)

SOURCE_GROUP(Metadata FILES ${OPENVDB_METADATA_SOURCE_FILES} ${OPENVDB_METADATA_HEADER_FILES})



#Tools

FILE(GLOB OPENVDB_TOOLS_SOURCE_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/tools/*.cc)

FILE(GLOB OPENVDB_TOOLS_HEADER_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/tools/*.h)

SOURCE_GROUP(Tools FILES ${OPENVDB_TOOLS_SOURCE_FILES} ${OPENVDB_TOOLS_HEADER_FILES})



#Tree

FILE(GLOB OPENVDB_TREE_SOURCE_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/tree/*.cc)

FILE(GLOB OPENVDB_TREE_HEADER_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/tree/*.h)

SOURCE_GROUP(Tree FILES ${OPENVDB_TREE_SOURCE_FILES} ${OPENVDB_TREE_HEADER_FILES})



#Util

FILE(GLOB OPENVDB_UTIL_SOURCE_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/util/*.cc)

FILE(GLOB OPENVDB_UTIL_HEADER_FILES
	${CMAKE_CURRENT_SOURCE_DIR}/util/*.h)

SOURCE_GROUP(Util FILES ${OPENVDB_UTIL_SOURCE_FILES} ${OPENVDB_UTIL_HEADER_FILES})



IF(MSVC)

	ADD_DEFINITIONS(-DNOMINMAX)

	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /bigobj")

ENDIF()



ADD_DEFINITIONS(-DOPENVDB_PRIVATE)



ADD_LIBRARY(openvdb STATIC ${OPENVDB_SOURCE_FILES} ${OPENVDB_HEADER_FILES}
	${OPENVDB_IO_SOURCE_FILES} ${OPENVDB_IO_HEADER_FILES}
	${OPENVDB_MATH_SOURCE_FILES} ${OPENVDB_MATH_HEADER_FILES}
	${OPENVDB_METADATA_SOURCE_FILES} ${OPENVDB_METADATA_HEADER_FILES}
	${OPENVDB_TOOLS_SOURCE_FILES} ${OPENVDB_TOOLS_HEADER_FILES}
	${OPENVDB_TREE_SOURCE_FILES} ${OPENVDB_TREE_HEADER_FILES}
	${OPENVDB_UTIL_SOURCE_FILES} ${OPENVDB_UTIL_HEADER_FILES})


TARGET_LINK_LIBRARIES(openvdb Half tbb_static ${ZLIB_LIBRARIES})



IF(DEFINED BUILD_UNITTEST AND BUILD_UNITTEST)

	ADD_SUBDIRECTORY(unittest)

ENDIF()



INSTALL(TARGETS openvdb RUNTIME DESTINATION bin
                        ARCHIVE DESTINATION lib)

INSTALL(FILES ${OPENVDB_HEADER_FILES} DESTINATION "${CMAKE_INSTALL_PREFIX}/include/openvdb")

INSTALL(FILES ${OPENVDB_IO_HEADER_FILES} DESTINATION "${CMAKE_INSTALL_PREFIX}/include/openvdb/io")

INSTALL(FILES ${OPENVDB_MATH_HEADER_FILES} DESTINATION "${CMAKE_INSTALL_PREFIX}/include/openvdb/math")

INSTALL(FILES ${OPENVDB_METADATA_HEADER_FILES} DESTINATION "${CMAKE_INSTALL_PREFIX}/include/openvdb/metadata")

INSTALL(FILES ${OPENVDB_TOOLS_HEADER_FILES} DESTINATION "${CMAKE_INSTALL_PREFIX}/include/openvdb/tools")

INSTALL(FILES ${OPENVDB_TREE_HEADER_FILES} DESTINATION "${CMAKE_INSTALL_PREFIX}/include/openvdb/tree")

INSTALL(FILES ${OPENVDB_UTIL_HEADER_FILES} DESTINATION "${CMAKE_INSTALL_PREFIX}/include/openvdb/util")
