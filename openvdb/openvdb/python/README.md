# `openvdb`

This project contains python bindings for OpenVDB.

## Installing from source

Installation using `pip` is preferred because it manages the package version
sensibly, and also automatically handles finding the correct python
installation.

### Using pip

The python bindings for OpenVDB can be installed using `pip install .`. In this
case, the build build toolchain executes in the following order:

1. The project's `pyproject.toml` is read, invoking the build backend. The
   `openvdb` python bindings use `scikit-build-core` as a build backend.
   `scikit-build-core` acts as [a wrapper for `cmake`][scikit-build-core].
3. `scikit-build-core` passes a sensible default set of flags which are defined
   in `pyproject.toml` under `tool.scikit-build.cmake.define` to `cmake`, which
   generates build files the project (ninja or GNU make).
4. `pybind11` generates the actual bindings for the project.
5. The project is built using whatever build toolchain cmake detected and
   configured. A shared object file is created with the python bindings.
6. `pip` copies the resulting shared object into your python installation's
   `site-packages` directory.

### Using cmake

Build files for the C++ code are generated by `cmake`, so the bindings can be
built by invoking

```bash
mkdir build
cd build
cmake ..
cmake --build .
cmake --install .
```

This will generate build files, build a shared object library, and copy it into
your python installation's `site-packages` directory, where it can be imported
directly. If you wish to target a particular version of python, this can be done
by setting [the appropriate cmake flags][cmake_flags]. `CMakeLists.txt` contains
a full listing of build options for more customization; by default the `openvdb`
package on PyPI is built with all the optional functionality enabled.

## Releasing to PyPI

Before creating an openvdb release, maintainers should be sure to update the
version string in `pyproject.toml`.

Using GitHub actions, new `openvdb` versions are published to PyPI automatically
when a new OpenVDB release is made. Releases can also published to PyPI by
triggering the "Build and Release Python Bindings to PyPI" job, and specifying a
branch/ref; if no ref is specified, the most recent commit on the given branch
is used. Publishing to PyPI requires an API token to be specified as a secret
(`PYPI_API_TOKEN`) on the repository.

If a maintainer wants to test the release process, they can do so by triggering
a workflow dispatch, and clicking the option to release to `test.pypi.org`. In
this case, a separate `TEST_PYPI_API_TOKEN` secret must be defined for the
repository. Once the release is published to the PYPI testing index, you can
install the release with

```bash
pip install -v --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple/ openvdb
```

This will install the `openvdb` package from test.pypi.org, but will allow
dependencies to be installed from the usual index (pypi.org).

## Contributors

Thanks to Alex Braun (@theNewFlesh) for contributing the original python
packaging for openvdb.

[scikit-build-core]: https://github.com/scikit-build/scikit-build-core
[cmake_flags]: https://cmake.org/cmake/help/latest/module/FindPython.html
